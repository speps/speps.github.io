<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>speps.fr - Rémi Gillig - Torus Trooper - Rebooting a 15 year-old game written in D - Part 1 Compiling</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="/css/main.css"/>
    <link rel="stylesheet" href="/highlight/zenburn.css">
    <link rel='shortcut icon' href='/favicon.ico' />
    <link rel='icon' href='/favicon.gif' type='image/gif'/>
    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles" />
    <link rel="openid2.local_id" href="https://profiles.google.com/remigillig" />
</head>
<body>
    <div id="bg-container">
        <div id="bg">
            <div id="bg-right"></div>
        </div>
    </div>
    <div id="main-container">
        <div id="main">
            <div id="header">
                <h1><a href="/" title="Return to the first page">speps.fr</a></h1>
                <ul>
                    <li><a href="/aboutme" title="Some information about myself"><span class="left"></span><span class="mid">About Me</span><span class="right"></span></a></li>
                    <li><a href="/projects" title="My work, my projects, my hobbies"><span class="left"></span><span class="mid">Projects</span><span class="right"></span></a></li>
                    <li><a href="/articles" title="Some articles I wrote"><span class="left"></span><span class="mid">Articles</span><span class="right"></span></a></li>
                    <li><a href="/resume" title="My resume for your recruiting needs"><span class="left"></span><span class="mid">Resume</span><span class="right"></span></a></li>
                    <li><a href="/links" title="What I spend my time with on the web"><span class="left"></span><span class="mid">Links</span><span class="right"></span></a></li>
                </ul>
                <div id="social"><a href="http://www.linkedin.com/in/remigillig"><img src="/images/linkedin.png"/></a></div>
                <div id="social">&nbsp;</div>
                <div id="social"><a href="http://twitter.com/remigillig"><img src="/images/twitter.png"/></a></div>
            </div>
<div id="content">
	<div id="page">
		
		<div id="sideinfo">
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#switching-from-ant-to-dub:95834070c7040d18a199c0907f30b458">Switching from Ant to DUB</a></li>
<li><a href="#compiling:95834070c7040d18a199c0907f30b458">Compiling</a></li>
<li><a href="#c-style-syntax-errors:95834070c7040d18a199c0907f30b458">C-style syntax errors</a></li>
<li><a href="#error-template-argument-expected-following:95834070c7040d18a199c0907f30b458">Error: template argument expected following !</a></li>
<li><a href="#replacing-char-with-string:95834070c7040d18a199c0907f30b458">Replacing <code>char[]</code> with <code>string</code></a></li>
<li><a href="#converting-value-to-string:95834070c7040d18a199c0907f30b458">Converting value to string</a></li>
<li><a href="#passing-strings-to-c:95834070c7040d18a199c0907f30b458">Passing strings to C</a></li>
<li><a href="#simple-substitution:95834070c7040d18a199c0907f30b458">Simple substitution</a></li>
<li><a href="#phobos:95834070c7040d18a199c0907f30b458">Phobos</a></li>
<li><a href="#operator-overloading:95834070c7040d18a199c0907f30b458">Operator overloading</a></li>
<li><a href="#linking-existing-libraries:95834070c7040d18a199c0907f30b458">Linking existing libraries</a></li>
<li><a href="#wrapping-up:95834070c7040d18a199c0907f30b458">Wrapping up</a></li>
</ul></li>
</ul>
</nav>
		</div>
		
		<h1>Torus Trooper - Rebooting a 15 year-old game written in D - Part 1 Compiling</h1>
		

<p>While exploring D recently, I remembered a game I played while at university 15 years ago. For a long time, I couldn&rsquo;t remember the name at all, only that it was from a Japanese developer. After some search wrangling, I finally managed to find the name of the game: Torus Trooper!</p>

<p>You can find it there: <a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/tt_e.html">http://www.asahi-net.or.jp/~cs8k-cyu/windows/tt_e.html</a></p>

<p><img src="/media/articles/tt1.png" alt="" /></p>

<p>Here is a copy of the tt0_22.zip file archived: <a href="https://github.com/speps/tt/archive/legacy.zip">https://github.com/speps/tt/archive/legacy.zip</a></p>

<p>What made me remember this game is that :</p>

<ul>
<li>It came with <a href="https://github.com/speps/tt/tree/legacy/src">source code</a>, quite unusual at the time for me</li>
<li>Written in D, a language I didn&rsquo;t know at all while I was busy studying C++</li>
<li>It&rsquo;s awfully addictive!</li>
</ul>

<p>What better project than try to compile a D v0.110 project in a modern version of D! So here we are&hellip;</p>

<p>Part 1 - Compiling a new executable
Part 2 - Running the game for the first time
Part 3 - Making it cross platform</p>

<h2 id="switching-from-ant-to-dub:95834070c7040d18a199c0907f30b458">Switching from Ant to DUB</h2>

<p>The game used Ant and its <code>build.xml</code> file to generate the executable, resources, etc. Since then, D added DUB as a build system / package manager so let&rsquo;s use that!</p>

<pre><code class="language-json">{
	&quot;authors&quot;: [
		&quot;Kenta Cho&quot;,
		&quot;Remi Gillig&quot;
	],
	&quot;copyright&quot;: &quot;Copyright © 2004 - Kenta Cho, 2020 - Remi Gillig&quot;,
	&quot;description&quot;: &quot;Torus Trooper (Reboot)&quot;,
	&quot;license&quot;: &quot;BSD 2-clause&quot;,
	&quot;name&quot;: &quot;tt&quot;,
	&quot;targetType&quot;: &quot;executable&quot;,
	&quot;sourcePaths&quot;: [
		&quot;src&quot;
	]
}
</code></pre>

<p>With this initial <code>dub.json</code> file, I was set to run the <code>dub</code> command&hellip;</p>

<pre><code>Performing &quot;debug&quot; build using C:\D\dmd2\windows\bin64\dmd.exe for x86.
tt ~master: building configuration &quot;application&quot;...
src\abagames\tt\barrage.d(95,33): Error: instead of C-style syntax, use D-style BulletMLParserTinyXML*[char[]][char[]] parser
src\abagames\tt\barrage.d(122,28): Error: instead of C-style syntax, use D-style BulletMLParserTinyXML*[] pl
src\abagames\tt\barrage.d(130,14): Error: instead of C-style syntax, use D-style BulletMLParserTinyXML*[char[]] pa
src\abagames\tt\boot.d(51,12): Error: instead of C-style syntax, use D-style char[4096] exe
src\abagames\tt\tunnel.d(300,14): Error: template argument expected following !
src\abagames\tt\tunnel.d(322,14): Error: template argument expected following !
src\abagames\util\rand.d(115,6): Error: instead of C-style syntax, use D-style uint[N] state
src\abagames\util\rand.d(140,20): Error: instead of C-style syntax, use D-style uint[] init_key
src\abagames\util\sdl\luminous.d(21,10): Error: instead of C-style syntax, use D-style GLuint[LUMINOUS_TEXTURE_WIDTH_MAX * LUMINOUS_TEXTURE_HEIGHT_MAX * 4 * (uint).sizeof] td
src\abagames\util\sdl\luminous.d(83,17): Error: instead of C-style syntax, use D-style float[2][2] lmOfs
C:\D\dmd2\windows\bin64\dmd.exe failed with exit code 1.
</code></pre>

<p>Alright let&rsquo;s start and get this to compile!</p>

<h2 id="compiling:95834070c7040d18a199c0907f30b458">Compiling</h2>

<h2 id="c-style-syntax-errors:95834070c7040d18a199c0907f30b458">C-style syntax errors</h2>

<p>This is one is easy to fix, the suggestion from the compiler works, I just replaced every instance of this error with the suggestion.</p>

<p>Here is an example:</p>

<pre><code class="language-diff">--- a/import/SDL_audio.d
+++ b/import/SDL_audio.d
@@ -42,7 +43,7 @@ struct SDL_AudioSpec {
     Once the callback returns, the buffer will no longer be valid.
     Stereo samples are stored in a LRLRLR ordering.
  */
- void (*callback)(void *userdata, Uint8 *stream, int len);
+ void function(void *userdata, Uint8 *stream, int len) callback;
  void  *userdata;
 }
</code></pre>

<h2 id="error-template-argument-expected-following:95834070c7040d18a199c0907f30b458">Error: template argument expected following !</h2>

<p>This is an interesting one, here is one of the files where this error triggers:</p>

<pre><code class="language-d">  private void calcIndex(in float z, out int idx, out float ofs) {
    idx = slice.length + 99999;
    for (int i = 1; i &lt; slice.length; i++) {
      if (z &lt; slice[i].depth) {
        idx = i - 1;
        ofs = (z - slice[idx].depth) / (slice[idx + 1].depth - slice[idx].depth);
        break;
      }
    }
    if (idx &lt; 0) {
      idx = 0;
      ofs = 0;
    } else if (idx &gt;= slice.length - 1) {
      idx = slice.length - 2;
      ofs = 0.99;
    }
    if (ofs !&gt;= 0) // ERROR HERE
      ofs = 0;
    else if (ofs &gt;= 1)
      ofs = 0.99;
  }
</code></pre>

<p>I did try a few searches without success so I asked on the D community forums and a few people guessed right, it&rsquo;s of course a <code>not &gt;=</code>, equivalent to <code>&lt;</code>. However, <a href="https://forum.dlang.org/post/rec3d1$toc$1@digitalmars.com">thanks to Walter Bright</a>, I got a link to the <a href="https://www.digitalmars.com/ctg/ctgNumerics.html#comparisons">original documentation from Digital Mars</a>. The subtle difference with <code>!&gt;=</code> is that it will also return <code>true</code> if any operands are <code>NaN</code>. Suggested fix seems to have worked:</p>

<pre><code class="language-d">    if (std.math.isNaN(ofs) || ofs &lt; 0)
      ofs = 0;
</code></pre>

<h2 id="replacing-char-with-string:95834070c7040d18a199c0907f30b458">Replacing <code>char[]</code> with <code>string</code></h2>

<p>D1 used to have <code>char[]</code> as the string type, and functions in <code>std.string</code> in Phobos to manipulate this type. D2 added a dedidcated <code>string</code> type instead of an alias. As a result, a lot of the code needs updating to deal with this. That includes the code in the custom bindings.</p>

<p>Most of the changes here are similar to this</p>

<pre><code class="language-diff">--- a/src/abagames/tt/barrage.d
+++ b/src/abagames/tt/barrage.d
@@ -92,24 +91,24 @@ public class Barrage {
  */
 public class BarrageManager {
  private:
-  static BulletMLParserTinyXML *parser[char[]][char[]];
-  static const char[] BARRAGE_DIR_NAME = &quot;barrage&quot;;
+  static BulletMLParserTinyXML*[string][string] parser;
+  static const string BARRAGE_DIR_NAME = &quot;barrage&quot;;
 
   public static void load() {
-    char[][] dirs = listdir(BARRAGE_DIR_NAME);
-    foreach (char[] dirName; dirs) {
-      char[][] files = listdir(BARRAGE_DIR_NAME ~ &quot;/&quot; ~ dirName);
-      foreach (char[] fileName; files) {
-        if (getExt(fileName) != &quot;xml&quot;)
+    string[] dirs = listdir(BARRAGE_DIR_NAME);
+    foreach (string dirName; dirs) {
+      string[] files = listdir(BARRAGE_DIR_NAME ~ &quot;/&quot; ~ dirName);
+      foreach (string fileName; files) {
+        if (fileName.extension != &quot;.xml&quot;)
           continue;
         parser[dirName][fileName] = getInstance(dirName, fileName);
       }
     }
   }
</code></pre>

<h2 id="converting-value-to-string:95834070c7040d18a199c0907f30b458">Converting value to string</h2>

<p>D1 used to have <code>std.string.toString</code> to convert a value to a <code>char[]</code> value. This functionality was replaced by <code>std.conv.to!string</code>.</p>

<pre><code class="language-diff">--- a/src/abagames/tt/shot.d
+++ b/src/abagames/tt/shot.d
@@ -5,6 +5,7 @@
  */
 module abagames.tt.shot;
 
+private import std.conv;
 private import std.math;
 private import std.string;
 private import opengl;
@@ -179,7 +180,7 @@ public class Shot: Actor {
       else if (sc &gt;= 2000)
         size = 0.7;
       size *= (1 + multiplier * 0.01f);
-      fl.set(&quot;X&quot; ~ std.string.toString(multiplier), pos, size * pos.y,
+      fl.set(&quot;X&quot; ~ to!string(multiplier), pos, size * pos.y,
              cast(int) (30 + multiplier * 0.3f));
     }
     if (chargeShot) {
</code></pre>

<h2 id="passing-strings-to-c:95834070c7040d18a199c0907f30b458">Passing strings to C</h2>

<p>The usual way to achieve seems to have been to just to use <code>std.string.toStringz</code>. However, back in D1 it used to return char* :</p>

<pre><code>char* toStringz(char[] s);
</code></pre>

<p>This worked well for the C bindings but with D2, it now returns:</p>

<pre><code>immutable(char)* toStringz(scope return string s) pure nothrow @trusted;
</code></pre>

<p>Again, the fix is quite straightforward. For example, the bindings weren&rsquo;t written with this in mind so they need fixing:</p>

<pre><code class="language-diff">--- a/import/SDL_rwops.d
+++ b/import/SDL_rwops.d
@@ -81,7 +81,7 @@ struct SDL_RWops {
 
 /* Functions to create SDL_RWops structures from various data sources */
 
-SDL_RWops * SDL_RWFromFile(char *file, char *mode);
+SDL_RWops * SDL_RWFromFile(const char *file, const char *mode);
</code></pre>

<h2 id="simple-substitution:95834070c7040d18a199c0907f30b458">Simple substitution</h2>

<ul>
<li><code>typedef</code> → <code>alias</code></li>
</ul>

<pre><code class="language-diff">--- a/import/SDL_rwops.d
+++ b/import/SDL_rwops.d
@@ -28,10 +28,10 @@ import SDL_types;
 
 extern(C):
 
-typedef int (*_seek_func_t)(SDL_RWops *context, int offset, int whence);
-typedef int (*_read_func_t)(SDL_RWops *context, void *ptr, int size, int maxnum);
-typedef int (*_write_func_t)(SDL_RWops *context, void *ptr, int size, int num);
-typedef int (*_close_func_t)(SDL_RWops *context);
+alias int function(SDL_RWops *context, int offset, int whence) _seek_func_t;
+alias int function(SDL_RWops *context, void *ptr, int size, int maxnum) _read_func_t;
+alias int function(SDL_RWops *context, void *ptr, int size, int num) _write_func_t;
+alias int function(SDL_RWops *context) _close_func_t;
</code></pre>

<ul>
<li><code>inout</code> → <code>ref</code>: this made sense for all instances where <code>inout</code> was used</li>
</ul>

<pre><code class="language-diff">--- a/src/abagames/tt/prefmanager.d
+++ b/src/abagames/tt/prefmanager.d
@@ -59,7 +59,7 @@ public class PrefData {
 
   public this() {
     gradeData = new GradeData[Ship.GRADE_NUM];
-    foreach (inout GradeData gd; gradeData)
+    foreach (ref GradeData gd; gradeData)
       gd = new GradeData;
   }
</code></pre>

<ul>
<li><code>auto T</code> → <code>auto</code>: it seems the original author specified auto along with the type which isn&rsquo;t allowed anymore</li>
</ul>

<pre><code class="language-diff">--- a/src/abagames/tt/shape.d
+++ b/src/abagames/tt/shape.d
@@ -631,9 +631,9 @@ public class BulletShape: Drawable {
   }
 
   private void createSquareShape(bool wireShape) {
-    auto Vector3 cp = new Vector3;
-    auto Vector3[] p = new Vector3[4];
-    auto Vector3[] np = new Vector3[4];
+    auto cp = new Vector3;
+    auto p = new Vector3[4];
+    auto np = new Vector3[4];
     static const float[][][] POINT_DAT = [
       [[-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1], ],
       [[-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1], ],
@@ -642,9 +642,9 @@ public class BulletShape: Drawable {
       [[1, -1, -1], [1, -1, 1], [1, 1, 1], [1, 1, -1], ],
       [[-1, -1, -1], [-1, -1, 1], [-1, 1, 1], [-1, 1, -1], ],
     ];
-    foreach (inout Vector3 ip; p)
+    foreach (ref Vector3 ip; p)
       ip = new Vector3;
-    foreach (inout Vector3 inp; np)
+    foreach (ref Vector3 inp; np)
       inp = new Vector3;
     for (int i = 0; i &lt; 6; i++) {
       cp.x = cp.y = cp.z = 0;
</code></pre>

<ul>
<li><code>getExt</code> → <code>.extension</code>: behaviour is different but it&rsquo;s easy enough to fix, it now includes the dot</li>
</ul>

<pre><code class="language-diff">--- a/src/abagames/tt/soundmanager.d
+++ b/src/abagames/tt/soundmanager.d
@@ -44,10 +45,10 @@ public class SoundManager: abagames.util.sdl.sound.SoundManager {
 
   private static Music[] loadMusics() {
     Music[] musics;
-    char[][] files = listdir(Music.dir);
-    foreach (char[] fileName; files) {
-      char[] ext = getExt(fileName);
-      if (ext != &quot;ogg&quot; &amp;&amp; ext != &quot;wav&quot;)
+    string[] files = listdir(Music.dir);
+    foreach (string fileName; files) {
+      string ext = fileName.extension;
+      if (ext != &quot;.ogg&quot; &amp;&amp; ext != &quot;.wav&quot;)
         continue;
       Music music = new Music();
       music.load(fileName);
</code></pre>

<ul>
<li><code>catch(Object)</code> → <code>catch(Throwable)</code>: you could throw any <code>Object</code> before, you have to use Throwable now</li>
</ul>

<pre><code class="language-diff">--- a/src/abagames/tt/boot.d
+++ b/src/abagames/tt/boot.d
@@ -83,20 +84,20 @@ public int boot(char[][] args) {
   }
   try {
     mainLoop.loop();
-  } catch (Object o) {
+  } catch (Throwable t) {
     try {
       gameManager.saveErrorReplay();
-    } catch (Object o1) {}
-    throw o;
+    } catch (Throwable) {}
+    throw t;
   }
   return EXIT_SUCCESS;
 }
</code></pre>

<ul>
<li><code>bit</code> → <code>SDL_bool</code>: the bit was used back in D1, it behaved like a <code>bool</code> but used one bit instead so you could make bitfields easily, it was mostly used in the SDL bindings so I replaced it with <code>SDL_bool</code></li>
</ul>

<pre><code class="language-diff">--- a/import/SDL_video.d
+++ b/import/SDL_video.d
@@ -132,7 +133,7 @@ const uint SDL_SRCALPHA	= 0x00010000;	/* Blit uses source alpha blending */
 const uint SDL_PREALLOC	= 0x01000000;	/* Surface uses preallocated memory */
 
 /* Evaluates to true if the surface needs to be locked before access */
-bit SDL_MUSTLOCK(SDL_Surface *surface)
+SDL_bool SDL_MUSTLOCK(SDL_Surface *surface)
 {
 	return surface.offset || ((surface.flags &amp;
 		(SDL_HWSURFACE | SDL_ASYNCBLIT | SDL_RLEACCEL)) != 0);
@@ -184,13 +185,7 @@ struct SDL_Overlay {
 	void /*private_yuvhwdata*/ *hwdata;
 
 	/* Special flags */
-	union
-	{
-		bit hw_overlay;
-		Uint32 _dummy;
-	}
-//		Uint32 hw_overlay :1;	/* Flag: This overlay hardware accelerated? */
-//		Uint32 UnusedBits :31;
+	Uint32 flags;
 }
</code></pre>

<h2 id="phobos:95834070c7040d18a199c0907f30b458">Phobos</h2>

<p>The old code did use <code>std.stream</code>, from what I read this was deprecated in favor of splitting it into a more modular design. However, to transition old code someone rescued the deprecated code and made it into a DUB package called <a href="https://code.dlang.org/packages/undead"><code>undead</code></a>.</p>

<p>This was very useful at the start to get the code to compile. However, I wanted to get rid of this dependency as it didn&rsquo;t feel right to keep old code instead of relying on the modern D equivalent. In D1, <code>std.stream.File.read</code> could read binary data into values. I&rsquo;ve changed it to use <code>std.file.read</code> and <code>std.bitmanip.read</code>. It&rsquo;s also important to make sure you specify the endian, the D1 code was implementation-specific regarding the format of types other than byte sized ones so I followed what convention it was on Windows which is little-endian. That means replays and highscores saves should be compatible!</p>

<pre><code class="language-diff">--- a/src/abagames/tt/replay.d
+++ b/src/abagames/tt/replay.d
@@ -5,7 +5,10 @@
  */
 module abagames.tt.replay;
 
-private import undead.stream;
+import std.file;
+import std.array;
+import std.bitmanip;
+
 private import abagames.util.sdl.recordablepad;
 
 /**
@@ -22,28 +25,24 @@ public class ReplayData {
  private:
 
   public void save(string fileName) {
-    auto fd = new File;
-    fd.create(dir ~ &quot;/&quot; ~ fileName);
-    fd.write(VERSION_NUM);
-    fd.write(level);
-    fd.write(grade);
-    fd.write(seed);
-    padRecord.save(fd);
-    fd.close();
+    auto buffer = appender!(ubyte[]);
+    buffer.append!(int, Endian.littleEndian)(VERSION_NUM);
+    buffer.append!(float, Endian.littleEndian)(level);
+    buffer.append!(int, Endian.littleEndian)(grade);
+    buffer.append!(long, Endian.littleEndian)(seed);
+    padRecord.save(buffer);
+    std.file.write(dir ~ &quot;/&quot; ~ fileName, buffer[]);
   }
 
   public void load(string fileName) {
-    auto fd = new File;
-    fd.open(dir ~ &quot;/&quot; ~ fileName);
-    int ver;
-    fd.read(ver);
+    auto buffer = cast(ubyte[])std.file.read(dir ~ &quot;/&quot; ~ fileName);
+    int ver = buffer.read!(int, Endian.littleEndian);
     if (ver != VERSION_NUM)
       throw new Error(&quot;Wrong version num&quot;);
-    fd.read(level);
-    fd.read(grade);
-    fd.read(seed);
+    level = buffer.read!(float, Endian.littleEndian);
+    grade = buffer.read!(int, Endian.littleEndian);
+    seed = buffer.read!(long, Endian.littleEndian);
     padRecord = new PadRecord;
-    padRecord.load(fd);
-    fd.close();
+    padRecord.load(buffer);
   }
 }
</code></pre>

<h2 id="operator-overloading:95834070c7040d18a199c0907f30b458">Operator overloading</h2>

<p>There is a <code>Vector</code> type in the codebase and naturally it used operator overloading. The syntax for this has changed though.</p>

<p>Before:</p>

<pre><code class="language-d">  public void opAddAssign(Vector v) {
    x += v.x;
    y += v.y;
  }

  public void opSubAssign(Vector v) {
    x -= v.x;
    y -= v.y;
  }

  public void opMulAssign(float a) {
    x *= a;
    y *= a;
  }

  public void opDivAssign(float a) {
    x /= a;
    y /= a;
  }
</code></pre>

<p>After:</p>

<pre><code class="language-d">  public void opOpAssign(string op)(Vector v) if (op == &quot;+&quot; || op == &quot;-&quot;) {
    mixin(&quot;x&quot; ~ op ~ &quot;=v.x;&quot;);
    mixin(&quot;y&quot; ~ op ~ &quot;=v.y;&quot;);
  }

  public void opOpAssign(string op)(float a) if (op == &quot;*&quot; || op == &quot;/&quot;) {
    mixin(&quot;x&quot; ~ op ~ &quot;=a;&quot;);
    mixin(&quot;y&quot; ~ op ~ &quot;=a;&quot;);
  }
</code></pre>

<p>This also shows the use of <code>mixin</code> to generate compile time code.</p>

<h2 id="linking-existing-libraries:95834070c7040d18a199c0907f30b458">Linking existing libraries</h2>

<p>The game also came with import libraries for SDL, SDL_mixer, OpenGL and GLU and a static library for BulletML, a custom library used by the original developer to load bullet patterns from XML. Those came as .lib files but they couldn&rsquo;t be read by the Windows SDK tools I tried, <code>lib</code> or <code>dumpbin</code> couldn&rsquo;t read them. However, by luck those files are still supported by <code>dmd</code> and it managed to link with them.</p>

<p>The changes required are mostly related to how the extern code was defined. For now, because I was only trying to produce a Windows version, I replaced uses of <code>version(Win32)</code> (which is now <code>version(Windows)</code>) with just <code>extern(Windows)</code> unconditionally.</p>

<pre><code class="language-diff">--- a/import/opengl.d
+++ b/import/opengl.d
@@ -1,10 +1,4 @@
-version (Win32) {
-	private import std.c.windows.windows;
-	extern(Windows):
-}
-version (linux) {
-	extern(C):
-}
+extern(Windows):
 
 alias uint GLenum;
 alias ubyte GLboolean;
</code></pre>

<p>The BulletML binding used <code>extern(C)</code> and that worked the same so no changes were done.</p>

<h2 id="wrapping-up:95834070c7040d18a199c0907f30b458">Wrapping up</h2>

<p>With all of this, we&rsquo;ve managed to compile a new Windows executable! What amazed me is how little language changes were necessary. The biggest change was related to Phobos and deprecated library features.</p>

	</div>
</div>
            <div id="footer"><p>2020-07-14 16:31:22 &#43;0000 - I speak for myself, I am not affiliated with any company - All rights reserved</p></div>
        </div>
    </div>
<script src="/highlight/highlight.pack.js"></script>
<script>
hljs.initHighlighting();
</script>
</body>
</html>